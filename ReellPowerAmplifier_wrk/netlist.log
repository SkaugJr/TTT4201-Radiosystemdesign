; Top Design: "PowerAmplifier_lib:S-Parameter:schematic"
; Netlisted using Hierarchy Policy: "Standard"

Options ResourceUsage=yes UseNutmegFormat=no EnableOptim=no TopDesignName="PowerAmplifier_lib:S-Parameter:schematic" DcopOutputNodeVoltages=yes DcopOutputPinCurrents=yes DcopOutputAllSweepPoints=no DcopOutputDcopType=0
; Library Name: Johanson_lib
; Cell Name: CapJT
; View Name: schematic
define CapJT ( P1  P2 ) 
parameters  C=1.0 pF 
C:C7  N__1 P2 C=0.937*C 
L:L1  P1 N__1 L=(0.647*(C/(1pF))^-0.0414) nH R=3.74*(C/(1pF))^-0.195 Ohm Noise=yes  
C:C10  P2 0 C=0.0317 pF 
C:C9  P1 0 C=0.0317 pF 
end CapJT

; Library Name: PowerAmplifier_lib
; Cell Name: IMC
; View Name: schematic
define IMC ( "RF-in"  "RF-out" ) 
;parameters 
MLIN2:TL6  N__1 N__6 Subst="MSub1" W=W mm L=L2 mm Wall1=2.5e+28 mm Wall2=2.5e+28 mm Mod=1 
VIA:V1  N__6 0 D1=0.8 mm D2=0.8 mm H=1.52 mm T=0.00375 mm 
model MSub1 MSUB H=1.52 mm Er=4.4 Mur=1 Cond=5.96e7 Hu=1e+33 mm T=35 um TanD=0.02 Rough=0 mm DielectricLossModel=1 FreqForEpsrTanD=1.0 GHz LowFreqForTanD=1.0 kHz HighFreqForTanD=1.0 THz RoughnessModel=2 
MLIN2:TL3  N__3 "RF-out" Subst="MSub1" W=W mm L=L1 mm Wall1=2.5e+28 mm Wall2=2.5e+28 mm Mod=1 
MTEE_ADS:Tee1  "RF-in" N__3 N__1 Subst="MSub1" W1=W mm W2=W mm W3=W mm 

W=2.89
L1=16.0557 opt{ 16 to 19 }
L2=3.09679 opt{ 3 to 5 }
end IMC

; Library Name: PowerAmplifier_lib
; Cell Name: OMC
; View Name: schematic
define OMC ( Load  PA ) 
;parameters 
VIA:V1  N__3 0 D1=0.8 mm D2=0.8 mm H=1.52 mm T=0.00375 mm 
model MSub1 MSUB H=1.52 mm Er=4.4 Mur=1 Cond=5.96e7 Hu=1e+33 mm T=35 um TanD=0.02 Rough=0 mm DielectricLossModel=1 FreqForEpsrTanD=1.0 GHz LowFreqForTanD=1.0 kHz HighFreqForTanD=1.0 THz RoughnessModel=2 

W=2.89
L1=22.0202 opt{ 22 to 25 }
L2=6.01496 opt{ 5 to 7 }
MLIN2:TL4  N__7 N__3 Subst="MSub1" W=W mm L=L2 mm Wall1=2.5e+28 mm Wall2=2.5e+28 mm Mod=1 
MLIN2:TL3  PA N__4 Subst="MSub1" W=W mm L=L1 mm Wall1=2.5e+28 mm Wall2=2.5e+28 mm Mod=1 
MTEE_ADS:Tee1  N__4 Load N__7 Subst="MSub1" W1=W mm W2=W mm W3=W mm 
end OMC

; Library Name: PowerAmplifier_lib
; Cell Name: PA
; View Name: schematic
define PA ( "DC-VD"  "DC-VG"  "RF-in"  "RF-out" ) 
;parameters 
#uselib "MA_RFP_ADS_v1p5" , "CG2H40010F_v2"
"CG2H40010F_v2":X1  N__1 N__16 0 Rth=7.83 Tbase=25 VDN=28 x1=1 x2=1 
R:R1  N__11 N__10 R=33 Ohm tune{ 10 Ohm to 150 Ohm by 10 Ohm } Noise=yes 
CapJT:Kap1  N__11 N__10 C=9.1 pF tune{ 2.8 pF to 20 pF by 0.56 pF } 
GRM18:C5  N__0 N__2 PartNumber=900 
GRM18:C4  N__5 N__18 PartNumber=900 
model MSub1 MSUB H=1.52 mm Er=4.4 Mur=1 Cond=5.96e7 Hu=1e+33 mm T=35 um TanD=0.02 Rough=0 mm DielectricLossModel=1 FreqForEpsrTanD=1.0 GHz LowFreqForTanD=1.0 kHz HighFreqForTanD=1.0 THz RoughnessModel=2 
MTEE_ADS:Tee1  N__18 N__11 "DC-VG" Subst="MSub1" W1=W3 mm W2=W2 mm W3=W1 mm 

W1=2.89
W2=1.6
W3=0.8
MLIN2:TL1  N__10 N__1 Subst="MSub1" W=W2 mm L=W2*2 mm Wall1=2.5e+28 mm Wall2=2.5e+28 mm Mod=1 
MTEE_ADS:Tee2  N__16 "DC-VD" N__0 Subst="MSub1" W1=W3 mm W2=W1 mm W3=W3 mm 
MLIN2:TL3  "RF-in" N__5 Subst="MSub1" W=W1 mm L=W1*2 mm Wall1=2.5e+28 mm Wall2=2.5e+28 mm Mod=1 
MLIN2:TL2  N__2 "RF-out" Subst="MSub1" W=W1 mm L=W1*2 mm Wall1=2.5e+28 mm Wall2=2.5e+28 mm Mod=1 
end PA

; Library Name: PowerAmplifier_lib
; Cell Name: VD-DC-Feed
; View Name: schematic
define "VD-DC-Feed" ( "DC-RF"  "DC-VD" ) 
;parameters 
VIA:V1  N__17 0 D1=0.8 mm D2=0.8 mm H=1.52 mm T=0.00375 mm 
VIA:V3  N__20 0 D1=0.4 mm D2=0.4 mm H=1.52 mm T=0.00375 mm 
CapJT:Kap1  0 N__4 C=82 pF 
MLIN2:TL10  N__5 "DC-VD" Subst="MSub1" W=W2 mm L=L2 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
model MSub1 MSUB H=1.52 mm Er=4.4 Mur=1 Cond=5.96e7 Hu=1e+33 mm T=35 um TanD=0.02 Rough=0 mm DielectricLossModel=1 FreqForEpsrTanD=1.0 GHz LowFreqForTanD=1.0 kHz HighFreqForTanD=1.0 THz RoughnessModel=2 

#ifndef muRataLibWeb_C
#define muRataLibWeb_C
; models
#include "C:/Github/TTT4201-Radiosystemdesign/ADSbibs/muRataLibWeb_C_EIA_confidential/circuit/models/encode.net"
#endif


MLIN2:TL9  N__1 N__3 Subst="MSub1" W=W2 mm L=L2 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
MLIN2:TL8  N__8 N__7 Subst="MSub1" W=W2 mm L=L2 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
MLIN2:TL5  N__9 N__11 Subst="MSub1" W=W2 mm L=L2 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
MLIN2:TL3  "DC-RF" N__12 Subst="MSub1" W=W1 mm L=L1 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
MLOC2:TL4  N__13 Subst="MSub1" W=W1 mm L=L1 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
MCROSO:Cros1  N__9 N__12 N__4 N__13 Subst="MSub1" W1=W2 mm W2=W1 mm W3=W2 mm W4=W1 mm 
MTEE_ADS:Tee5  N__5 N__3 N__14 Subst="MSub1" W1=W2 mm W2=W2 mm W3=W4 mm 
MTEE_ADS:Tee4  N__1 N__7 N__15 Subst="MSub1" W1=W2 mm W2=W2 mm W3=W4 mm 
MTEE_ADS:Tee1  N__8 N__11 N__16 Subst="MSub1" W1=W2 mm W2=W2 mm W3=W3 mm 
VIA:V2  N__19 0 D1=0.8 mm D2=0.8 mm H=1.52 mm T=0.00375 mm 
GRM18:C5  N__20 N__16 PartNumber=900 
GRM31:C7  N__17 N__14 PartNumber=545 
GRM31:C6  N__19 N__15 PartNumber=456 

L1=17.145
L2=3.2
L3=10
L4=10

W1=2.89
W2=0.8
W3=0.7
W4=1.6
end "VD-DC-Feed"

; Library Name: PowerAmplifier_lib
; Cell Name: VG-DC-Feed
; View Name: schematic
define "VG-DC-Feed" ( "DC-RF"  "DC-VG" ) 
;parameters 
VIA:V1  N__14 0 D1=0.8 mm D2=0.8 mm H=1.52 mm T=0.00375 mm 
CapJT:Kap1  0 N__1 C=82 pF 
MLIN2:TL10  N__16 "DC-VG" Subst="MSub1" W=W2 mm L=L2 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
model MSub1 MSUB H=1.52 mm Er=4.4 Mur=1 Cond=5.96e7 Hu=1e+33 mm T=35 um TanD=0.02 Rough=0 mm DielectricLossModel=1 FreqForEpsrTanD=1.0 GHz LowFreqForTanD=1.0 kHz HighFreqForTanD=1.0 THz RoughnessModel=2 

#ifndef muRataLibWeb_C
#define muRataLibWeb_C
; models
#include "C:/Github/TTT4201-Radiosystemdesign/ADSbibs/muRataLibWeb_C_EIA_confidential/circuit/models/encode.net"
#endif


MLIN2:TL3  "DC-RF" N__0 Subst="MSub1" W=W1 mm L=L1 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
MLOC2:TL4  N__3 Subst="MSub1" W=W1 mm L=L1 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
MCROSO:Cros1  N__18 N__0 N__1 N__3 Subst="MSub1" W1=W2 mm W2=W1 mm W3=W2 mm W4=W1 mm 
MTEE_ADS:Tee1  N__20 N__10 N__13 Subst="MSub1" W1=W2 mm W2=W2 mm W3=W3 mm 
GRM18:C5  N__4 N__13 PartNumber=900 
GRM31:C6  N__8 N__15 PartNumber=456 
GRM31:C7  N__14 N__17 PartNumber=545 
MLIN2:TL5  N__18 N__10 Subst="MSub1" W=W2 mm L=L2 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
MLIN2:TL8  N__20 N__21 Subst="MSub1" W=W2 mm L=L2 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
MTEE_ADS:Tee4  N__12 N__21 N__15 Subst="MSub1" W1=W2 mm W2=W2 mm W3=W4 mm 
MTEE_ADS:Tee5  N__16 N__19 N__17 Subst="MSub1" W1=W2 mm W2=W2 mm W3=W4 mm 
MLIN2:TL9  N__12 N__19 Subst="MSub1" W=W2 mm L=L2 mm Wall1=1.0E+30 mil Wall2=1.0E+30 mil Mod=1 
VIA:V3  N__4 0 D1=0.4 mm D2=0.4 mm H=1.52 mm T=0.00375 mm 
VIA:V2  N__8 0 D1=0.8 mm D2=0.8 mm H=1.52 mm T=0.00375 mm 

W1=2.89
W2=0.8
W3=0.7
W4=1.6

L1=17.145
L2=3.2
end "VG-DC-Feed"

S_Param:SP1 CalcS=yes CalcY=no CalcZ=no CalcGroupDelay=yes GroupDelayAperture=1e-4 \
FreqConversion=no FreqConversionPort=1 StatusLevel=2 CalcNoise=no SortNoise=0 BandwidthForNoise=1.0 Hz DevOpPtLevel=0 SPSS_WSP=yes \
SweepVar="freq" SweepPlan="SP1_stim" OutputPlan="SP1_Output" 

SweepPlan: SP1_stim Start=0.1 GHz Stop=6 GHz Step=0.05 GHz 

OutputPlan:SP1_Output \
      Type="Output" \
      UseEquationNestLevel=yes \
      EquationNestLevel=2 \
      EquationName[1]="Z0" \
      UseSavedEquationNestLevel=yes \
      SavedEquationNestLevel=2

#load "python","LinearCollapse"
Component Module="LinearCollapse" Type="ModelExtractor" NetworkRepresentation=2

Z0=50
Port:Term1  N__8 0 Num=1 Z=Z0 Noise=yes 
Port:Term2  N__12 0 Num=2 Z=Z0 Noise=yes 
V_Source:SRC1  N__0 0 Type="V_DC" Vdc=-2.8 V SaveCurrent=1 

Options:Options1 Temp=16.85 Tnom=25 TopologyCheck=yes ForceS_Params=yes V_RelTol=1e-6  \
I_RelTol=1e-6 GiveAllWarnings=yes MaxWarnings=10 ForceM_Params=yes DC_ReadInitialGuess=no  \
DC_WriteFinalSolution=no TopologyCheckMessages=no GPU=no doDeltaAC=no ReduceSPort=no  \
ReduceSPortRatio=0.5 WarnSOA=yes MaxWarnSOA=5 Census=no MinNodalR=1e-2 Ohm  \
LargeCapThreshold=1e-3 F EnableAssertChecks=no EnableSpareRemoval=yes 

aele mu_load=mu(S);mu_source=mu_prime(S);match_input=sm_gamma1(S);Source_stabcir=s_stab_circle(S,51);Load_stabcir=l_stab_circle(S,51);
PA:X1  N__6 N__3 N__1 N__2 
V_Source:SRC2  N__7 0 Type="V_DC" Vdc=28 V SaveCurrent=1 
"VD-DC-Feed":X2  N__6 N__7 
"VG-DC-Feed":X3  N__3 N__0 
IMC:X4  N__8 N__1 
OMC:X5  N__12 N__2 

Optim:"Optim1" OptimType="hpVMO" ErrorForm="L2" SAProgressReport=0 MaxIters=50 P=2 DesiredError=0.0 StatusLevel=4 FinalAnalysis="SP1" NormalizeGoals=yes SetBestValues=yes SaveSolns=yes SaveGoals=yes SaveOptimVars=no UpdateDataset=yes SaveNominal=no SaveAllIterations=no UseAllOptVars=yes UseAllGoals=yes SaveCurrentEF=no InitialTempControlMode=0 SANumTrialsPerIter=10 NumShootsPerIter=20 SATempControlAlpha=0.8 EnableCockpit=yes NormalizeError=yes SaveAllTrials=no UseAdvTermCriteria=no CostRelativeTol=1.0e-8 LimitOfContSmallImprovement=5 

OptimGoal:OptimGoal1 Expr="mag(S(2,1))" SimInstanceName="SP1" Weight=1.0 \
SpecLimitLine[1]="OptimGoal1_limit1" 
SpecLimitLine:"OptimGoal1_limit1" Type="Inside" Min=16.5 Max=18 Weight=1.0 
